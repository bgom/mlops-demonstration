<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:hx-on="http://www.w3.org/1999/xhtml">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.9" integrity="sha384-QFjmbokDn2DjBjq+fM+8LUIVrAgqcNW2s0PjAxHETgRn9l4fvX31ZxDxvwQnyMOX" crossorigin="anonymous"></script>

</head>
<body hx-boost="true">
<div id="dataPointsChartContainer" class="container">
    <!-- Container for Chart -->
    <div id="chartContainer" class="row w-100">
        <canvas id="chart"></canvas>

        <script th:inline="javascript">
            function renderChart() {
                /*<![CDATA[*/
                const dataPoints = /*[[${dataPoints}]]*/ [];
                const ctx = document.getElementById('chart').getContext('2d');
                let chart = Chart.getChart("chart"); // <canvas> id
                console.log(chart)
                if (chart != undefined) {
                    chart.destroy();
                }

                new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            data: dataPoints.map(p => ({ x: p.x, y: p.y })),
                            backgroundColor: dataPoints.map(p => p.colorName)
                        }]
                    },
                    options: {
                        scales: {
                            x: { beginAtZero: true },
                            y: { beginAtZero: true }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Source of Truth',
                                fontSize: 18,
                                position: 'top'
                            },
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                /*]]>*/
            }
            renderChart()
        </script>
    </div>
    <!-- Button to Generate New Data Points or Reload Data -->
    <button hx-get="/colors/data-point-chart?generateNewBatch=false" hx-target="#dataPointsChartContainer" hx-swap="outerHTML"
            class="row w-100 btn btn-primary mb-3">
        Shuffle Data
    </button>
</div>
</body>
</html>
